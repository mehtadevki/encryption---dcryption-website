<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Encryption Decryption App</title>
  <script src="https://cdn.jsdelivr.net/npm/crypto-js@4.1.1/crypto-js.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jsencrypt/bin/jsencrypt.min.js"></script>
  <style>
    body {
      font-family: Arial;
      padding: 20px;
      text-align: center;
      background-color: #fff2e6; /* Light theme */
      color: #333;
    }

    textarea {
      width: 80%;
      height: 60px;
      margin: 10px 0;
      padding: 10px;
      font-size: 16px;
      border: 2px solid #ffb366;
      background-color: #fffaf0;
      border-radius: 8px;
      box-shadow: 2px 2px 4px #ccc;
    }

    button {
      padding: 10px 20px;
      font-size: 16px;
      margin: 10px;
      background-color: #ffa64d;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    button:hover {
      background-color: #e67300;
    }

    h2 {
      color: #cc6600;
    }
  </style>
</head>
<body>

  <h1>Encryption and Decryption</h1><br>

  <h2>Plain Text:</h2><br>
  <textarea id="plainText" placeholder="Enter your message here..."></textarea><br><br><br>

  <h2>Encrypted Message:</h2><br>
  <textarea id="encryptedMessage" readonly></textarea><br><br>

  <h2>Encrypted AES Key:</h2><br>
  <textarea id="encryptedKey" readonly></textarea><br>

  <button onclick="encryptText()">Encrypt</button><br><br><br>

  <h2>Decrypted Message:</h2><br>
  <textarea id="decryptedMessage" readonly></textarea><br>

  <button onclick="decryptText()">Decrypt</button><br>

  <script>
    // Generate RSA Key Pair ONCE
    const rsa = new JSEncrypt();
    rsa.getKey(); // This auto-generates the key pair
    const publicKey = rsa.getPublicKey();
    const privateKey = rsa.getPrivateKey();

    let aesKey = "";               // AES key
    let encryptedMessage = "";     // AES encrypted message
    let encryptedAESKey = "";      // RSA encrypted AES key

    function encryptText() {
      const plainText = document.getElementById("plainText").value;

      // Generate AES key
      aesKey = CryptoJS.lib.WordArray.random(16).toString();

      // Encrypt message using AES key
      encryptedMessage = CryptoJS.AES.encrypt(plainText, aesKey).toString();

      // Encrypt AES key using RSA public key
      const rsaEncryptor = new JSEncrypt();
      rsaEncryptor.setPublicKey(publicKey);
      encryptedAESKey = rsaEncryptor.encrypt(aesKey);

      document.getElementById("encryptedMessage").value = encryptedMessage;
      document.getElementById("encryptedKey").value = encryptedAESKey;
    }

    function decryptText() {
      // Decrypt AES key using private key
      const rsaDecryptor = new JSEncrypt();
      rsaDecryptor.setPrivateKey(privateKey);
      const decryptedAESKey = rsaDecryptor.decrypt(encryptedAESKey);

      if (!decryptedAESKey) {
        alert("Decryption failed: AES key not decrypted");
        return;
      }

      // Decrypt message using decrypted AES key
      const decrypted = CryptoJS.AES.decrypt(encryptedMessage, decryptedAESKey).toString(CryptoJS.enc.Utf8);

      if (!decrypted) {
        alert("AES decryption failed. Ciphertext or key may be wrong.");
        return;
      }

      document.getElementById("decryptedMessage").value = decrypted;
    }
  </script>
</body>
</html>
